# Development Guide

Quick start guide for local development of Family Task Manager.

## Quick Start with Docker

```bash
# Clone repository
git clone https://github.com/DylanChiang-Dev/family-task-manager.git
cd family-task-manager

# Start Docker services
docker-compose up -d

# View services status
docker-compose ps

# View logs
docker-compose logs -f
```

**Access URLs:**
- Main Application: http://localhost:8080
- phpMyAdmin: http://localhost:8081 (root/root)
- MySQL: localhost:3306

**Docker Services:**
- `web`: PHP 8.1-FPM with PDO extensions
- `nginx`: Nginx Alpine (reverse proxy)
- `db`: MySQL 8.0 (mysql_native_password)
- `phpmyadmin`: Database management GUI

## Alternative: PHP Built-in Server

```bash
# Create database
mysql -u root -p -e "CREATE DATABASE family_tasks CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# Start server
cd public && php -S localhost:8000

# Access application
open http://localhost:8000
```

## Installation Wizard

After starting the server, complete the 4-step installation:

1. **Environment Check**: Verifies PHP version, PDO extension, file permissions
2. **Database Configuration**: Enter credentials and test connection
3. **Admin Account**: Create your administrator account
4. **Complete**: Installation finished!

## Database Credentials

**Docker Environment:**
- Host: `db` (Docker service name)
- Port: 3306
- Database: `family_tasks`
- User: `family_user`
- Password: `family_pass`
- Root Password: `root`

**Local Development:**
- Host: `localhost`
- Port: 3306
- Database: `family_tasks`
- User: `root`
- Password: (your local password)

## Common Tasks

### Reset Installation

```bash
# Remove configuration files
rm -f config/installed.lock config/database.php config/config.php

# Drop and recreate database (Docker)
docker-compose exec db mysql -u root -proot -e "DROP DATABASE family_tasks; CREATE DATABASE family_tasks CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# Restart installation wizard
open http://localhost:8080
```

### View Logs

```bash
# Docker logs
docker-compose logs -f web
docker-compose logs -f nginx
docker-compose logs -f db

# PHP error log (check docker/php/php.ini for path)
docker-compose exec web tail -f /var/log/nginx/php_errors.log
```

### Database Operations

```bash
# Access MySQL shell
docker-compose exec db mysql -u family_user -pfamily_pass family_tasks

# Import schema manually
docker-compose exec -T db mysql -u family_user -pfamily_pass family_tasks < database/schema.sql

# Backup database
docker-compose exec db mysqldump -u family_user -pfamily_pass family_tasks > backup.sql

# Restore database
docker-compose exec -T db mysql -u family_user -pfamily_pass family_tasks < backup.sql
```

### Stop and Clean

```bash
# Stop services
docker-compose down

# Stop and remove volumes (WARNING: deletes database)
docker-compose down -v

# Remove all containers and images
docker-compose down --rmi all -v
```

## File Structure

- `/api/*` - Backend RESTful APIs
- `/config/*` - Configuration (generated by installer, not in git)
- `/database/schema.sql` - Database structure
- `/install/*` - Installation wizard
- `/public/*` - Web-accessible files
- `/docker/*` - Docker configuration

## Key Files

- `docker-compose.yml` - Docker services
- `Dockerfile` - PHP-FPM image
- `docker/nginx/default.conf` - Nginx routing
- `config/Database.php` - Singleton DB connection
- `public/index.php` - Main entry point
- `public/js/app.js` - Frontend logic

## Development Tips

1. **Docker Auto-reload**: Files are synced via volumes, no rebuild needed for code changes
2. **Database Port**: MySQL is exposed on port 3306 for external tools
3. **Nginx Logs**: Check `docker-compose logs nginx` for routing issues
4. **PDO Debugging**: Set `PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION` in Database.php

## Troubleshooting

### Port Already in Use

```bash
# Check what's using port 8080
lsof -i :8080

# Change ports in docker-compose.yml
ports:
  - "8090:80"  # Changed from 8080
```

### Config Directory Not Writable

```bash
chmod -R 777 config/
```

### Database Connection Failed

- Check if MySQL container is running: `docker-compose ps`
- Verify credentials in installation wizard
- Use `db` as hostname (not `localhost`) for Docker

### White Screen / PHP Errors

```bash
# Check PHP logs
docker-compose logs web

# Enable display_errors in docker/php/php.ini
display_errors = On
```

## Next Steps

- See [CLAUDE.md](CLAUDE.md) for detailed architecture
- Check [README.md](README.md) for deployment guides
- View [docs/](docs/) for additional documentation

Happy coding! ðŸš€

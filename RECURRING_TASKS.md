# 週期任務功能說明

## 功能概述

系統現在支持三種任務類型：

1. **一般任務**：單次任務，有固定的截止日期
2. **週期任務**：自動重複的任務（每天/每週/每月/每年）
3. **重複任務**：從現有任務複製的任務

## 優先級顏色標識

- 🔴 **紅色** = 高優先級（緊急）
- 🔵 **藍色** = 中優先級
- 🟢 **綠色** = 低優先級

## 日曆功能

- 日曆中每個日期方框會顯示當天的任務（最多5條）
- 超過5條任務時顯示「+N 更多」
- 任務使用優先級顏色標識
- 點擊日期可查看當天的完整任務列表

## 週期任務配置

### 每天重複
選擇「週期任務」→「每天」，任務將每天顯示在日曆上。

### 每週重複
選擇「週期任務」→「每週」，然後選擇星期幾（可多選）。
例如：選擇一、三、五，任務將在每週的週一、週三、週五顯示。

### 每月重複
選擇「週期任務」→「每月」，輸入日期（用逗號分隔）。
例如：輸入「1,15」，任務將在每月1號和15號顯示。

### 每年重複
選擇「週期任務」→「每年」，選擇月份和日期。
例如：6月15日，任務將在每年6月15日顯示。

## 資料庫遷移

如果您已經有現有的資料庫，請執行以下命令來更新資料庫結構：

```bash
# Docker 環境
docker compose exec db mysql -u root -proot family_tasks < database/migrations/add_recurring_tasks.sql

# 本地 MySQL
mysql -u root -p family_tasks < database/migrations/add_recurring_tasks.sql
```

## 技術細節

### 資料庫欄位
- `task_type`: ENUM('normal', 'recurring', 'repeatable')
- `recurrence_config`: JSON（存儲週期配置）
- `parent_task_id`: INT（重複任務的來源任務 ID）

### 週期配置 JSON 格式

**每天**:
```json
{"frequency": "daily"}
```

**每週**:
```json
{"frequency": "weekly", "days": [1, 3, 5]}
```

**每月**:
```json
{"frequency": "monthly", "dates": [1, 15]}
```

**每年**:
```json
{"frequency": "yearly", "month": 6, "date": 15}
```

### 前端實現
- 週期任務在日曆渲染時動態生成實例
- 每個實例標記為 `isRecurringInstance: true`
- 不會在資料庫中創建重複記錄，只存儲週期規則

## 使用建議

1. **家務任務**：使用每天或每週重複（如倒垃圾、打掃房間）
2. **賬單提醒**：使用每月重複（如水電費、房租）
3. **生日紀念日**：使用每年重複
4. **工作計畫**：使用每週重複特定工作日

## 注意事項

- 週期任務不會創建實際的截止日期記錄，只在顯示時計算
- 編輯週期任務會影響所有未來的顯示
- 如需修改特定日期的任務，請使用「重複任務」功能複製一個新任務
